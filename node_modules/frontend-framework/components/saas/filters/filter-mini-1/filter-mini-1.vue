<template>
    <section :class="componentName">
        <form method="get" :action="'/used/' + vehicleType">
            <div>
                <select name="make" @change="getData()" v-model="make">
                    <option value="">All Makes</option>
                    <option v-for="option in allMakes" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select name="range" @change="getData()" :disabled="make == ''" v-model="range">
                    <option value="">All Models</option>
                    <option v-for="option in allRanges" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select name="fuel_type" @change="getData()" v-model="fuel_type">
                    <option value="">All Fuel Types</option>
                    <option v-for="option in allFuelTypes" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select name="transmission" @change="getData()" v-model="transmission">
                    <option value="">All Transmissions</option>
                    <option v-for="option in allTransmissions" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <input type="submit" value="Search">
        </form>
    </section>
</template>




<script>
    var CancelToken = axios.CancelToken;
    var source = CancelToken.source();
    export default {
        name: 'FilterMini1',
        props: {
            componentName: {
                default: 'filter-mini-1',
                type: String
            },
            vehicleType: {
                default: 'cars',
                type: String
            }
        },
        data () {
            return {
                category: '/used/all',
                resultsReturned: 500,
                allMakes: {},
                allRanges: {},
                allFuelTypes: {},
                allTransmissions: {},
                monthlyFroms: {},
                monthlyTos: {},
                minPrices: {},
                maxPrices: {},
                mileage: 8000,
                deposit: 300,
                term: 48,
                finance_type: 'price',
                monthly_from: '',
                monthly_to: '',
                min_price: '',
                max_price: '',
                make: '',
                range: '',
                fuel_type: '',
                transmission: '',
            }
        },
        mounted() {
             this.getData();
        },
        computed: {
            filters: function () {
                return {
                    make: this.make,
                    range: this.range,
                    fuel_type: this.fuel_type,
                    transmission: this.transmission,
                };
            }
        },
        methods: {
            getData: function () {
                console.log('FilterMini1: getData');

                axios.get(this.category + '/ajax-search', {
                    params: this.filters,
                    cancelToken: source.token
                }).then(
                    response => {
                        console.log('response', response.data);
                        this.allMakes = _.slice(response.data.options.make,1);
                        this.allRanges = _.slice(response.data.options.range,1);
                        this.allFuelTypes = _.slice(response.data.options.fuel_type,1);
                        this.allTransmissions = _.slice(response.data.options.transmission,1);
                        this.monthlyFroms = response.data.finance.monthly_from;
                        this.monthlyTos = response.data.finance.monthly_to;
                        this.minPrices = response.data.finance.min_price;
                        this.maxPrices = response.data.finance.max_price;
                    }
                ).catch(function (thrown) {
                    if (axios.isCancel(thrown)) {
                        console.log('Error: ', thrown);
                    }
                });
            }
        },
        // watch: {
        //     make: {
        //         handler: "getData"
        //     },
        //     range: {
        //         handler: "getData"
        //     },
        //     fuel_type: {
        //         handler: "getData"
        //     },
        //     transmission: {
        //         handler: "getData"
        //     },
        // }
    }
</script>
