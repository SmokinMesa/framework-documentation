<template>
    <section :id="id">
        <form method="get" :action="'/used/' + vehicleType">

            <div>
                <select v-model="make" name="make">
                    <option value="">All Makes</option>
                    <option v-for="option in allMakes" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select v-model="range" name="range" :disabled="make == ''">
                    <option value="">All Models</option>
                    <option v-for="option in allRanges" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select v-model="min_price" name="min_price">
                    <option value="">Min Price</option>
                    <option v-for="(option, value) in minPrices" :value="value">{{ option }}</option>
                </select>
            </div>

            <div>
                <select v-model="max_price" name="max_price">
                    <option value="">Max Price</option>
                    <option v-for="(option, value) in maxPrices" :value="value">{{ option }}</option>
                </select>
            </div>

            <div>
                <select v-model="fuel_type" name="fuel_type">
                    <option value="">All Fuel Types</option>
                    <option v-for="option in allFuelTypes" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <div>
                <select v-model="transmission" name="transmission">
                    <option value="">All Transmissions</option>
                    <option v-for="option in allTransmissions" :value="option.id">{{ option.label }}</option>
                </select>
            </div>

            <input type="hidden" name="layout" value="grid">
            <input type="hidden" name="sort" value="price|asc">
            <input type="hidden" name="resultsPerPage" value="12">

            <input type="submit" value="Search" @click="logAbHomeTest();">
        </form>
    </section>
</template>




<script>
    var CancelToken = axios.CancelToken;
    var source = CancelToken.source();
    export default {
        name: 'FilterMini2',
        props: {
            id: {
                default: 'id',
                type: String
            },
            vehicleType: {
                default: 'cars',
                type: String
            },
            version: {
                default: 'a'
            }
        },
        data () {
            return {
                category: '/used/all',
                resultsReturned: 500,
                allMakes: {},
                allRanges: {},
                allFuelTypes: {},
                allTransmissions: {},
                monthlyFroms: {},
                monthlyTos: {},
                minPrices: {},
                maxPrices: {},
                mileage: 8000,
                deposit: 300,
                term: 48,
                finance_type: 'price',
                monthly_from: '',
                monthly_to: '',
                min_price: '',
                max_price: '',
                make: '',
                range: '',
                fuel_type: '',
                transmission: '',
            }
        },
        computed: {
            filters: function () {
                return {
                    make: this.make,
                    range: this.range,
                    fuel_type: this.fuel_type,
                    transmission: this.transmission,
                };
            }
        },
        methods: {
            logAbHomeTest: function(){
                if(this.version == 'b') {
                    this.$root.dataLayerEvent('ab_home_enquire_button_b');
                }else{
                    this.$root.dataLayerEvent('ab_home_enquire_button_a');
                }
            },
            getData: function () {
                axios.get(this.category + '/ajax-search', {
                    params: this.filters,
                    cancelToken: source.token
                }).then(
                    response => {
                        this.allMakes = _.slice(response.data.options.make,1);
                        this.allRanges = _.slice(response.data.options.range,1);
                        this.allFuelTypes = _.slice(response.data.options.fuel_type,1);
                        this.allTransmissions = _.slice(response.data.options.transmission,1);
                        this.monthlyFroms = response.data.finance.monthly_from;
                        this.monthlyTos = response.data.finance.monthly_to;
                        this.minPrices = response.data.finance.min_price;
                        this.maxPrices = response.data.finance.max_price;
                    }
                ).catch(function (thrown) {
                    if (axios.isCancel(thrown)) {
                    }
                });
            }
        },
        mounted() {
             this.getData();
        },
        watch: {
            make: {
                handler: "getData"
            },
            range: {
                handler: "getData"
            },
            fuel_type: {
                handler: "getData"
            },
            transmission: {
                handler: "getData"
            },
            min_price: {
                handler: "getData"
            },
            max_price: {
                handler: "getData"
            }
        }
    }
</script>
