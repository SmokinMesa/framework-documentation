<template>
	<section :class="componentName">
        <form 
            method="get"
            :action="'/used/cars/search'"
        >
            <div class="select">
                <select 
                    id="make" 
                    name="make"
                    @change="range='';getData();"
                    v-model="make"
                >
                    <option 
                        v-for="option in allMakes"
                        :key="option.id"
                        :value="option.id"
                    >
                        {{ option.label }}
                    </option>
                </select>

                <label class="icon-circle" for="make">
                    <icon-arrow-down-ct />
                </label>
            </div>

            <div 
                class="select"
                :class="{ disabled: make == '' }"
            >   
                <select 
                    id="range" 
                    name="range"
                    @change="getData()"
                    :disabled="make == ''"
                    v-model="range"
                >
                    <option 
                        v-for="option in allRanges" 
                        :key="option.id"
                        :value="option.id"
                    >
                        {{ option.label }}
                    </option>
                </select>

                <label class="icon-circle" for="make">
                    <icon-arrow-down-ct />
                </label>
            </div>

            <button 
                class="large primary icon-circle"
                type="submit"
            >
                <span>Show {{ resultsReturned }} Results</span>  

                <icon-search-ct />
            </button>

            <nuxt-link class="show-all" to="/used/cars/search" title="Show all vehicles">Show me all cars</nuxt-link>
        </form>
    </section>
</template>




<script>
    export default {
        name: 'filter-mini-1',
        props: {
			componentName: {
				default: "filter-mini-1",
                type: String
			}
		},
        data () {
            return {
                category: '/used/cars',
                resultsReturned: null,
                // locations: 3,
                // toggleMobile: true,
                // isActive: false,

                allMakes: null,
                allRanges: null,
                // allTrims: {},
                // allFuelTypes: {},
                // allTransmissions: {},
                // allMonthlyFrom: {},
                // allMonthlyTo: {},
                // allMinPrice: {},
                // allMaxPrice: {},
                // allAge: {},
                // allMileage: {},
                // allBodyType: {},
                // allNoDoors: {},
                // allNoSeats: {},
                // allColor: {},
                // allInsuranceGroups: {},
                // allLocations: {},

                make: '',
                range: '',
                // trim: 'Any Trim',
                // fuel_type: 'fuel type',
                // finance_type: 'price',
                // transmission: 'Any',
                // monthlyFrom: 'No Min',
                // monthlyTo: 'No Max',
                // minPrice: 'No Min',
                // maxPrice: 'No Max',
                // age: 'Any',
                // mileage: 'Any',
                // bodyType: 'Any',
                // noDoors: 'Any',
                // noSeats: 'Any',
                // color: 'Any',
                // insurance: 'Any',
                // location: 'Any'
            }
        },
        created() {
            this.getData();
        },
        computed: {
            filters() {
                return {
                    make: this.make,
                    range: this.range,
                    resultsPerPage: 1,
                    // trim: this.trim,
                    // fuel_type: this.fuel_type,
                    // transmission: this.transmission,
                    // monthlyFrom: this.monthlyFrom,
                    // monthlyTo: this.monthlyTo,
                    // minPrice: this.minPrice,
                    // maxPrice: this.maxPrice,
                    // age: this.age,
                    // mileage: this.mileage,
                    // bodyType: this.bodyType,
                    // noDoors: this.noDoors,
                    // noSeats: this.noSeats,
                    // color: this.color,
                    // location: this.location,
                    // insurance: this.insurance,
                };
            }
        },
        methods: {
            // togglePayment(section) {
            //     if (this.finance_type == 'price') {
            //         this.finance_type = 'monthly';
            //     } else {
            //         this.finance_type = 'price';
            //     }
            // },
            // toggleMobileFilters: function(){
            //     this.isActive = !this.isActive;

            //     return false;
            // },
            getData() {
                this.$axios.get('/used/cars/ajax-search/', {
                    params: this.filters
                }).then(response => {
                    this.allMakes = response.data.options.make;
                    this.allRanges = response.data.options.range;
                }).catch((e) => {
                    console.log(e);

                    if(e.response.status === 404) {
                        error({ statusCode: 404, message: 'Can not get all makes' })
                    }
                });
                
                this.$axios.get('/api/used-vehicles/cars/search/', {
                    params: this.filters
                }).then(response => {
                   this.resultsReturned = response.data.meta.total;
                }).catch((e) => {
                    console.log(e);

                    if(e.response.status === 404) {
                        error({ statusCode: 404, message: 'Can not get all makes' })
                    }
                });
            },
        },
    }
</script>