<template>
	<section :class="componentName">
		<div class="sw">
			<header class="main-header sw">
				<h1>Latest posts</h1>

				<a class="button outline" href="/blog">View all posts</a> 
			</header>

			<section :class="componentName + '-carousel'">
				<article v-for="(post, index) in blog" :class="{ 'active' : currentSlide === index }" class="col-6 blog-card">
					<a class="img-container" :href="'blog/' + post.page_slug">
						<img :src="post.contents.main_image" :alt="post.page_title">
					</a>

					<div class="content">
						<h1 class="post-title">
							<a :href="'blog' + post.page_slug">{{ post.page_title }}</a>
						</h1>

						<a class="post-category" :href="'/blog/' + post.category">{{ post.category }}</a>

						<footer class="blog-card-footer">
							<div class="info">
								<a :href="'/blog/author/' + post.author.slug" class="post-author">
									<img class="avatar" src="http://i.pravatar.cc/30" :alt="'Avatar for' + post.author.first_name + ' ' + post.author.last_name"></img>
									by {{ post.author.first_name + ' ' + post.author.last_name }}
								</a>

								<a class="read-more" :href="'/blog/' + post.page_slug">Read full article</a>
							</div>

							<time class="time-posted">{{ post.published_at.date  | formatBlogTime }}</time>
						</footer>
					</div>
				</article>

				<div class="spacer"></div>
			</section>	

			<nav>
				<ul>
					<li v-for="(position, index) in numOfSlides" :class="{ 'active' : currentSlide === index }" class="slide-indicator" @click="setScrollPosition(index)">
		            	<span hidden>View slide {{ index }}</span>
		            </li>
				</ul>
			</nav>
		</div>
	</section>
</template>




<script>
	export default {
		name: 'Bloglatest-image-1-1',
		props: {
			componentName: {
				default: 'bloglatest-image-1-1',
				type: String
			}
		},
		data() {
			return {
				blog: [
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "1 Malesuada ultricies arcu non dictum sapien moillis ullamcorper pellentesque convallis ex at volutpat lore…",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1448518340475-e3c680e9b4be?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1351&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "2 Malesuada ultricies arcu non dictum sapien moillis ullamcorper pellentesque",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "3 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "4 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "5 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					}
				],
				scrollPositions: [],
				numOfSlides: null,
				currentSlide: 0
			}
		},
		mounted() {
			window.addEventListener('resize', this.createSlides);
			this.carousel = document.getElementsByClassName(this.componentName + '-carousel')[0];
			this.createSlides();
		},
		methods: {
			createSlides() {
				let carouselWidth = this.carousel.offsetWidth;
				let carouselScrollWidth = this.carousel.scrollWidth;

				// calculate no of slides needed
				this.numOfSlides = Math.ceil(carouselScrollWidth / carouselWidth);

				// set the first scroll position to 0
				this.scrollPositions[0] = 0;

				// set following scroll positions by incrementally adding carousel width
				for (var i = 1; i < this.numOfSlides; i++) {
					this.scrollPositions[i] = this.scrollPositions[i-1] + carouselWidth;
				} 
			},
			setScrollPosition(index) {
				this.currentSlide = index;
				this.carousel.scrollLeft = this.scrollPositions[index];
			}
		},
		beforeDestroy() {
			window.removeEventListener('resize', this.createSlides);
		}
	}
</script>