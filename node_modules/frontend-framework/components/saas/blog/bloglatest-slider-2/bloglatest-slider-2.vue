<template>
	<section :class="componentName">
		<header class="sw main-header">
				<h1>Latest posts</h1>

				<a class="button outline" href="/blog">View all posts</a> 
			</header>

			<section class="carousel-container cf" @mouseover="timerPause()" @mouseleave="timerPlay()">
				<div class="col-8 img-container">

					<transition name="fade" mode="out-in">
						<a :href="/blog/ + blog[currentPost].page_slug">
							<img :src="blog[currentPost].contents.main_image" :alt="blog[currentPost].page_title">
							<div class="post-link"><span hidden>View post</span></div>
						</a>
					</transition>

					<a class="post-category" :href="/blog/ + blog[currentPost].category">{{ blog[currentPost].category }}</a>
				</div>

				<div id="carousel-side" class="col-4 content">
					<article v-for="(post, index) in blog" :class="{ 'active-post' : index === currentPost }" class="card">
						<a class="card-thumbnail" :href="/blog/ + blog[index].page_slug">
							<img :src="blog[index].contents.main_image" :alt="blog[index].page_title">
						</a>

						<div class="card-content">
							<h1 class="post-title">
								<a :href="/blog/ + blog[index].page_slug">{{ blog[index].page_title }}</a>
							</h1>

							<div class="card-footer">
								<a class="post-author" :href="blog/author/ + blog[index].author.slug">by {{ blog[index].author.first_name + ' ' + blog[index].author.last_name }}</a>
								
								<time class="time-posted">{{ blog[index].published_at.date  | formatBlogTime }}</time>
							</div>
						</div>
					</article>
				</div>
			</section>
	</section>
</template>




<script>
	export default {
		name: 'Bloglatest-slider-2',
		props: {
			componentName: {
				default: 'bloglatest-slider-2',
				type: String
			},
			timeBetweenSlides: {
				default: 4000,
				type: Number
			},
			autoScroll: {
				default: true,
				type: Boolean
			},
		},
		data() {
			return {
				currentPost: 0,
				blog: [
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Malesuada ultricies arcu non dictum sapien moillis ullamcorper pellentesque convallis ex at volutpat lore…",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1448518340475-e3c680e9b4be?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1351&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Malesuada ultricies arcu non dictum sapien moillis ullamcorper pellentesque",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1471174617910-3e9c04f58ff5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=092cd4f8bbc80ac2395d2debfac73df4&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "steve",
							last_name: "smith",
							slug: "steve-smith"
						},
						category: "reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster.",
							main_image: "https://images.unsplash.com/photo-1476067897447-d0c5df27b5df?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80"
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					}
				],
				timerActivated: true,
				interval: null
			}
		},
		mounted() {
			if (this.autoScroll) {
				this.timerPlay();
			}
			this.scrollToCurrent();
		},
		methods: {
			timerPlay() {
				if (this.autoScroll) {
					this.timerActivated = true;

					var that = this;
					this.interval = setInterval(function () {
						that.tempTimer++;

						if (that.currentPost < (that.blog.length - 1)) {
							that.currentPost++;

							that.scrollSlide(that.currentPost);	
					
							that.scrollToCurrent();
						}
						else if (that.currentPost == (that.blog.length - 1)) {
							that.currentPost = 0;
					
							that.scrollToCurrent();
						}
					}, that.timeBetweenSlides);
				}
			},
			timerPause() {
				this.timerActivated = false;
				
				clearInterval(this.interval);
			},
            scrollSlide(dir) {
                if (dir == 'prev' && this.currentPost > 0) {
                    this.currentPost = this.currentPost -= 1;
                } 
                else if (dir == 'next' && this.currentPost < (this.slides.length - 1)) {
                    this.currentPost = this.currentPost += 1;
					
                } 
                else if (typeof dir === 'number') {
                	this.currentPost = dir;
                }
            },
            scrollToCurrent() {
            	let postContainer = document.getElementById('carousel-side');
            	let activePost = document.getElementsByClassName('active-post')[0];
            	let topPos = activePost.offsetTop;

            	if (this.currentPost === 0) {
            		postContainer.scrollTop = 0;
            	} else {
            		postContainer.scrollTop = topPos;
            	}
            }
		}
	}
</script>