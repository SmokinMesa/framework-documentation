<template>
	<section :class="componentName">
		<div class="sw">
			<header class="main-header">
				<h1>Latest posts</h1>

				<a class="button outline" href="/blog">View all posts</a> 
			</header>
		
			<section :class="componentName + '-carousel'">
				<article v-for="(post, index) in blog" :class="{ 'active' : currentSlide === index }" class="col-6 blog-card">
					<header class="blog-card-header">
						<h1 class="post-title">
							<a :href="'/blog/' + post.page_slug">{{ post.page_title }}</a>
						</h1>

						<a class="post-category" :href="'/blog/' + post.category">{{ post.category }}</a>
					</header>

					<a class="blog-card-main" :href="'/blog/' + post.page_slug">{{ post.contents.introduction | truncate(125) }}</a>

					<footer class="blog-card-footer">
						<div class="content">
							<a :href="'/blog/author/' + post.author.slug" class="post-author">
								<img class="avatar" src="http://i.pravatar.cc/30" :alt="'Avatar for' + post.author.first_name + ' ' + post.author.last_name"></img>
								by {{ post.author.first_name + ' ' + post.author.last_name }}
							</a>

							<a class="read-more" :href="'/blog/' + post.page_slug">Read full article</a>
						</div>

						<time class="time-posted">{{ post.published_at.date  | formatBlogTime }}</time>
					</footer>
				</article>

				<div class="spacer"></div>
			</section>	

			<nav>
				<ul>
					<li v-for="(position, index) in numOfSlides" :class="{ 'active' : currentSlide === index }" class="slide-indicator" @click="setScrollPosition(index)">
		            	<span hidden>View slide {{ index }}</span>
		            </li>
				</ul>
			</nav>
		</div>
	</section>
</template>




<script>
	export default {
		name: 'Bloglatest-text-2-1',
		props: {
			componentName: {
				default: 'bloglatest-text-2-1',
				type: String
			}
		},
		data() {
			return {
				blog: [
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "1 Easy Car Buying with the New Autostore Website!",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "2 Easy Car Buying with the New Autostore Website!",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "3 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "4 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "5 Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					}
				],
				scrollPositions: [],
				numOfSlides: null,
				currentSlide: 0
			}
		},
		mounted() {
			window.addEventListener('resize', this.createSlides);
			this.carousel = document.getElementsByClassName(this.componentName + '-carousel')[0];
			this.createSlides();
		},
		methods: {
			createSlides() {
				let carouselWidth = this.carousel.offsetWidth;
				let carouselScrollWidth = this.carousel.scrollWidth;

				// calculate no of slides needed
				this.numOfSlides = Math.ceil(carouselScrollWidth / carouselWidth);

				// set the first scroll position to 0
				this.scrollPositions[0] = 0;

				// set following scroll positions by incrementally adding carousel width
				for (var i = 1; i < this.numOfSlides; i++) {
					this.scrollPositions[i] = this.scrollPositions[i-1] + carouselWidth;
				} 
			},
			setScrollPosition(index) {
				this.currentSlide = index;
				this.carousel.scrollLeft = this.scrollPositions[index];
			}
		},
		beforeDestroy() {
			window.removeEventListener('resize', this.createSlides);
		}
	}
</script>