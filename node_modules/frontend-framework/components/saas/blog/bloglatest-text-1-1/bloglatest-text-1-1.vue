<template>
	<section :class="componentName">
		<div class="sw">
			<header class="main-header">
				<h1>Latest posts</h1>

				<ul class="nav">
					<li class="prev" @click="setScrollPosition('prev')" :class="{'disabled' : currentSlide === 0}">
		                <span hidden>View previous post</span>
		            </li>

		            <li class="next" @click="setScrollPosition('next')" :class="{'disabled' : currentSlide === numOfSlides-1}">
		                <span hidden>View next post</span>
		            </li>
				</ul>
			</header>

			<section :class="componentName + '-carousel'">
				<article v-for="(post, index) in blog" class="col-4 blog-card">
					<header class="blog-card-header">
						<p class="time-posted">{{ post.published_at.date  | formatBlogTime }}</p>

						<a class="post-category" :href="/blog/ + post.category">{{ post.category }}</a>
					</header>

					<a :href="'/blog/' + post.page_slug">
						<h1 class="post-title">{{ post.page_title }}</h1>

						<p class="post-intro">{{ post.contents.introduction | truncate(125) }}</p>
					</a>

					<footer class="blog-card-footer">
						<a :href="'/blog/author/' + post.author.slug" class="post-author">
							<img class="avatar" src="http://i.pravatar.cc/30" :alt="'Avatar for ' + post.author.first_name + ' ' + post.author.last_name"></img>
							by {{ post.author.first_name + ' ' + post.author.last_name }}
						</a>

						<a class="read-more" :href="'/blog/' + post.page_slug">Read full article</a>
					</footer>
				</article>
			</section>	
		</div>
	</section>
</template>




<script>
	export default {
		name: 'Bloglatest-text-1-1',
		props: {
			componentName: {
				default: 'bloglatest-text-1-1',
				type: String
			}
		},
		data() {
			return {
				scrollPositions: [],
				numOfSlides: null,
				currentSlide: 0,
				blog: [
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post One Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Two Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Three Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Four Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Five Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Six Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
					{	
						author: {
							first_name: "Steve",
							last_name: "Smith",
							slug: "steve-smith"
						},
						category: "Reviews",
						contents: {
							introduction: "It’s been an exciting time at Autostore. Our showroom at Penrith is going from strength to strength and we’re now beginning to welcome lots of happy customers to our new site in Lancaster."
						},
						page_slug: "easy-car-buying-with-the-new-autostore-website",
						page_title: "Post Seven Easy Car Buying",
						published_at: {
							date: "2019-01-10 14:56:00.000000"
						}
					},
				],
			}
		},
		mounted() {
			window.addEventListener('resize', this.createSlides);
			this.carousel = document.getElementsByClassName(this.componentName + '-carousel')[0];
			this.createSlides();
		},
		methods: {
			createSlides() {
				let carouselWidth = this.carousel.offsetWidth;
				let carouselScrollWidth = this.carousel.scrollWidth;

				// calculate no of slides needed
				this.numOfSlides = Math.ceil(carouselScrollWidth / carouselWidth);

				// set the first scroll position to 0
				this.scrollPositions[0] = 0;

				// reset carousel scroll position and currentSlide each time slides created.
				this.carousel.scrollLeft = this.scrollPositions[0];
				this.currentSlide = 0;

				// set following scroll positions by incrementally adding carousel width
				for (var i = 1; i < this.numOfSlides; i++) {
					this.scrollPositions[i] = this.scrollPositions[i-1] + carouselWidth;
				} 
			},
			setScrollPosition(direction) {
				if (direction === 'next') {
					this.carousel.scrollLeft = this.scrollPositions[this.currentSlide + 1];
					this.currentSlide++;

				} else if (direction === 'prev') {
					this.carousel.scrollLeft = this.scrollPositions[this.currentSlide - 1];
					this.currentSlide--;
				}
			}
		},
		beforeDestroy() {
			window.removeEventListener('resize', this.createSlides);
		}
	}
</script>