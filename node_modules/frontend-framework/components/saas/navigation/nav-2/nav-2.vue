<template>
	<header :id="componentName">
		<aside class="header-top">
			<form v-if="isFranchise" id="location" class="inline">
				<div class="select-wrapper">
					<select name="location-list" form="location" @change="getRequest()" v-model="selectedLocation">
						<option v-for="location in locations">{{ location.name }}</option>
					</select>

					<icon-chevron-down />
				</div>

				<div class="select-wrapper">
					<select name="franchise-list" form="location" @change="getRequest()" v-model="selectedFranchise">
						<option v-for="franchise in franchises">{{ franchise.name }}</option>
					</select>

					<icon-chevron-down />
				</div>
			</form>

			<div class="social cf">
				<button class="no-style social-nav-toggle" @click="toggleSocialVisible()">
					<span hidden>Toggle social icons</span>
				</button>

				<div class="social-nav cf" :class="{ 'active' : isSocialVisible }">
					<slot name="social">
						<a href="#" title="facebook">
				        	<icon-social-facebook />
							<span hidden>Share on Facebook</span>
						</a>
				        <a href="#" title="Twitter">
				        	<icon-social-twitter />
				        	<span hidden>Share on Twitter</span>
				        </a>
				        <a href="#" title="Google Plus">
				        	<icon-social-googleplus />
				        	<span hidden>Share on Google Plus</span>
				        </a>
				        <a href="#" title="Pinterest">
				        	<icon-social-pinterest />
				        	<span hidden>Share on Pinterest</span>
				        </a>
				        <a href="#" title="YouTube">
				        	<icon-social-instagram />
				        	<span hidden>Share on YouTube</span>
				        </a>
				        <a href="#" title="LinkedIn">
				        	<icon-social-linkedin />
				        	<span hidden>Share on LinkedIn</span>
				        </a>
					</slot>
				</div>
			</div>
		</aside>


		<div class="logo-container">
			<img class="logo" src="http://acmelogos.com/images/logo-1.svg" alt="[logo]">
		</div>


		<div class="header-bottom">
			<button class="no-style mobile-nav-toggle" @click="toggleNavVisible()">
				<span hidden>Toggle Navigation</span>
				<!-- <icon-close v-if="isNavVisible" />  TODO -->
			</button>

			<nav :class="{ 'active' : isNavVisible }">
				<ul class="main-nav">
					<li v-for="nav in navMain">
						<a :href="nav.url" :title="nav.name">
							{{ nav.name }}
							<icon-chevron-down v-if="nav.children.length" />
						</a>

						<ul v-if="nav.children.length" class="nested-nav">
							<li v-for="child in nav.children">
								<a :href="child.url" :title="child.name">{{ child.name }}</a>
							</li>
						</ul>
					</li>
				</ul>

				<div v-if="needsOverflowNav" class="overflow-nav-toggle">
					<ul class="overflow-nav">
						<li v-for="nav in navOverflow">
							<a :class="{ 'dropdown' : nav.children.length }" :href="nav.url" :title="nav.name">{{ nav.name }}</a>

							<ul v-if="nav.children.length" class="nested-nav">
								<li v-for="child in nav.children"><a :href="child.url" :title="child.name">{{ child.name }}</a></li>
							</ul>
						</li>
					</ul>
				</div> 
			</nav>
		</div>
	</header>
</template>




<script>
    import axios from 'axios';

	export default {
		name: 'Nav1',
		props: {
			componentName: {
				default: 'nav-2',
				type: String
			},
			splitNavAt: {
				default: 5,
				type: Number
			},
			isFranchise: {
				default: false,
				type: Boolean
			}
		},
		data() {
			return {
				isSocialVisible: false,
				isNavVisible: false,
				needsOverflowNav: false,
				navMain: '',
				navOverflow: '',
				locations: [
					{
						id: 1,
						name: 'Location 1'
					},
					{
						id: 2,
						name: 'Location 2'
					},
					{
						id: 3,
						name: 'Location 3'
					},
					{
						id: 4,
						name: 'Location 4'
					}
				],
				franchises: [
					{
						id: 1,
						name: 'Franchises 1'
					},
					{
						id: 2,
						name: 'Franchises 2'
					},
					{
						id: 3,
						name: 'Franchises 3'
					},
					{
						id: 4,
						name: 'Franchises 4'
					}
				],
				selectedLocation: '',
				selectedFranchise: '',
			}
		},
		created() {
			//  preselect options
			this.selectedLocation = this.locations[0].name;
			this.selectedFranchise = this.franchises[0].name;

			axios.get("http://frontend.test/api/menu/main-nav")
				.then((response)  =>  {
					console.log(response);
					let returnedNav = response.data.data;

					this.navMain = Object.keys(returnedNav).map(function (values) { 
						return returnedNav[values] 
					});

					if (navMain.length > this.splitNavAt) {
						this.navMain = navMain.slice(0, this.splitNavAt);
						this.navOverflow = navMain.slice(this.splitNavAt, navMain.length);
						this.needsOverflowNav = true;
					}

					if (navMain.length < this.splitNavAt) {
						this.navMain = navMain;
						this.needsOverflowNav = false;
					}
				}, (error)  =>  {
					console.log('Failed to GET menu');
				}
			)
		},
		methods: {
			toggleSocialVisible() {
				this.isSocialVisible = !this.isSocialVisible;
			},
			toggleNavVisible() {
				this.isNavVisible = !this.isNavVisible;
			},
			getRequest() {
				//	fire request

				alert("selectedLocation: " + this.selectedLocation + "\n" + "selectedFranchise: " + this.selectedFranchise);
			}
		},
	}
</script>
