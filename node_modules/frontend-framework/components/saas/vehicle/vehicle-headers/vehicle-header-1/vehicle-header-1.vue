<template>
	<section :class="[componentName, { 'showing-modal' : isEnlarged }]"> 
		<div class="vehicle-tools">
			<div class="tool-menu">
				<div class="tool favourite">
					<button class="no-style toggle favourite"><span hidden>Favourite this vehicle</span>
						<icon-favourite />
					</button>

					<p class="slide">Add to favourites</p>
				</div>
			
				<div class="tool compare">
					<button class="no-style toggle compare"><span hidden>Compare this vehicle</span>
						<icon-compare />
					</button>

					<p class="slide">Add to compare</p>
				</div>
			
				<div class="tool social">
					<button class="no-style toggle share"><span hidden>Share this vehicle</span>
						<icon-share />
					</button>

					<div class="slide">
						<p>Share on</p>
						<a href="#" title="facebook">
				        	<icon-social-facebook />
							<span hidden>Share on Facebook</span>
						</a>
				        <a href="#" title="Twitter">
				        	<icon-social-twitter />
				        	<span hidden>Share on Twitter</span>
				        </a>
				        <a href="#" title="Google Plus">
				        	<icon-social-googleplus />
				        	<span hidden>Share on Google Plus</span>
				        </a>
				        <a href="#" title="Pinterest">
				        	<icon-social-pinterest />
				        	<span hidden>Share on Pinterest</span>
				        </a>
				        <a href="#" title="YouTube">
				        	<icon-social-instagram />
				        	<span hidden>Share on YouTube</span>
				        </a>
				        <a href="#" title="LinkedIn">
				        	<icon-social-linkedin />
				        	<span hidden>Share on LinkedIn</span>
				        </a>
			    	</div>
				</div>
			

				<button v-if="vehicle.media_urls.length" class="no-style tool enlarge" @click="toggleEnglarge()"><span hidden>Enlarge images</span>
					<icon-enlarge />
				</button>
			</div>

			<div class="tools-drawer"></div>
		</div>




		<aside class="carousel-container">
			<!-- main image  -->
			<img v-if="vehicle.media_urls.length" class="image-main" :src="vehicle.media_urls[currentImage].medium" :alt="vehicle.name">
			<img v-else class="image-placeholder" :src="placeholderImage" alt="Sorry no images for this vehicle">
			
			<ul v-if="vehicle.media_urls.length > 1" class="nav">
				<li class="prev" @click="requestImage('prev')" :disabled="currentImage === 0">
					<span hidden>View previous image</span>

					<icon-chevron-left />
				</li>
	            <li class="next" @click="requestImage('next')" :disabled="this.currentImage === vehicle.media_urls.length -1">
	            	<span hidden>View next image</span>

	            	<icon-chevron-right />
	            </li>
        	</ul>

			<!-- thumbnails	 -->
			<nav v-if="vehicle.media_urls.length" class="thumbnail-container">
				<ul :class="componentName + 'thumbnail-carousel'" ref="thumbs">
					<li v-for="(image, index) in vehicle.media_urls" :class="[{ 'active' : index === currentImage }, 'thumb-' + index]" @click="currentImage = index">
						<img class="image-thumbnail" :src="image.thumb" :alt="vehicle.name">
					</li>
				</ul>

                <ul v-if="vehicle.media_urls.length > 5">
                    <li class="prev" @click="setScrollPosition('prev')" :class="{'disabled' : currentSlide === 0}">
                    	<span hidden>Scroll carousel left</span>

                    	<icon-chevron-left />
                    </li>
                    <li class="next" @click="setScrollPosition('next')" :class="{'disabled' : currentSlide === numOfSlides-1}">
                    	<span hidden>Scroll carousel right</span>

                    	<icon-chevron-right />
                    </li>
                </ul>
			</nav>
		
			<p v-if="vehicle.media_urls.length" class="image-count">
				<icon-camera />
				{{ currentImage + 1 }} of {{ vehicle.media_urls.length }}
			</p>
		</aside>
		

		<article class="sw content">
			<div class="col-4 vehicle-title">
				<h1><span class="reg-date">{{ vehicle.formatted_plate }}</span>{{ vehicle.model }}</h1>	
				<h2 class="vehicle-name">{{ vehicle.name | titlecase }}</h2>

				<ul class="vehicle-specs">
					<li v-if="vehicle.odometer_value">
						<icon-mileage />
						{{ vehicle.odometer_value | formatNumberWithCommas }} miles
					</li>
					<li v-if="vehicle.fuel_type.name">
						<icon-fuel />
						{{ vehicle.fuel_type.name }}
					</li>
					<li v-if="vehicle.technical_spec.transmission">
						<icon-transmission />
						{{ vehicle.technical_spec.transmission | titlecase }}
					</li>
				</ul>
			</div>

			<div class="col-4 vehicle-price-container">
				<div class="vehicle-price">
					<p class="price">&pound;{{ vehicle.price | formatPrice }}</p>
					<p class="price-note">+ &pound;[fee] admin fee <icon-tooltip /></p>
				</div>

				<div class="vehicle-price-monthly">
					<p v-if="hasFinance" class="price">[Â£pm]<span class="pcm">pcm</span></p>
					<p class="price-note">Hire Purchase <icon-tooltip /></p>
				</div>
			</div>

			<div class="col-4 vehicle-cta">
				<a href="#" class="button outline" title="Apply for Finance">Apply for Finance</a>
				<a href="#" class="button primary outline" title="Enquire">Enquire</a>
			</div>
		</article>

		<transition name="enlarge" out-in>
			<div v-if="isEnlarged" class="enlarge-modal">
				<span class="close" @click="toggleEnglarge()"><span hidden>Close</span>
					<icon-close />
				</span>

				<img :src="vehicle.media_urls[currentImage].large" :alt="vehicle.name">	
			</div>
		</transition>
	</section>
</template>




<script>
	export default {
		name: "VehicleHeader1",
		props: {
            componentName: {
                default: 'vehicle-header-1',
                type: String
            },
            vehicle: Object,
            placeholderImage: {
            	default: 'https://via.placeholder.com/1920.png?text=Awaiting+Images',
            	type: String
            },
            hasFinance: {
                default: true,
                type: Boolean
            }      
		},
		data() {
			return {
				currentImage: 0,
				isEnlarged: false,
				scrollPositions: [],
				numOfSlides: null,
				currentSlide: 0,
			}
		},
		mounted() {
			window.addEventListener('resize', this.createSlides);
			this.carousel = document.getElementsByClassName(this.componentName + 'thumbnail-carousel')[0];
			this.createSlides();
		},
		methods: {
			requestImage(requested) {
				if (requested === 'prev') {
					this.currentImage--;
				}

				if (requested === 'next') {
					this.currentImage++;
				}
			},
			toggleEnglarge() {
				this.isEnlarged = !this.isEnlarged;
			},
			createSlides() {
				let carouselWidth = this.carousel.offsetWidth;
				let carouselScrollWidth = this.carousel.scrollWidth;

				// calculate no of slides needed
				this.numOfSlides = Math.ceil(carouselScrollWidth / carouselWidth);

				// set the first scroll position to 0
				this.scrollPositions[0] = 0;

				// reset carousel scroll position and currentSlide each time slides created.
				this.carousel.scrollLeft = this.scrollPositions[0];
				this.currentSlide = 0;

				// set following scroll positions by incrementally adding carousel width
				for (var i = 1; i < this.numOfSlides; i++) {
					this.scrollPositions[i] = this.scrollPositions[i-1] + carouselWidth;
				} 
			},
			setScrollPosition(direction) {
				if (direction === 'next') {
					this.carousel.scrollLeft = this.scrollPositions[this.currentSlide + 1];
					this.currentSlide++;

				} else if (direction === 'prev') {
					this.carousel.scrollLeft = this.scrollPositions[this.currentSlide - 1];
					this.currentSlide--;
				}
			}
		},
		beforeDestroy() {
			window.removeEventListener('resize', this.createSlides);
		}
	}
</script>