<template>
    <nav :class="componentName">        
        <button 
            class="no-style nav-trigger"
            :class="{ 'active' : $store.state.isVisible.siteNav }"
            role="navigation"
            aria-label="button to toggle nav"
            @click="toggleSiteNav()"
        >
            <span hidden>Toggle the side navigation</span>

            <icon-menu-close v-if="$store.state.isVisible.siteNav" />
            <icon-menu-dots v-else />
        </button>
        
        <transition name="site-nav-parent">
            <ul 
                v-if="$store.state.isVisible.siteNav"
                class="nav-col"
            >
                <li 
                    v-for="(parent, index) in nav"
                    class="link-parent"
                >
                    <nuxt-link
                        tag="span"
                        :to="'/' + parent.parent"
                        :event="true ? '' : 'click'"
                    >
                        {{ parent.parent }}
                    </nuxt-link>

                    <div class="grouped-children">
                        <!-- v-if="child.grandchildren" -->
                        <nuxt-link 
                            v-for="(child, index) in parent.children"
                            tag="ul"
                            :to="child.url"
                            class="nav-child"
                            :class="{ 'expanded' : index == activeGrandChild }"
                            :event="true ? '' : 'click'"
                            @click.native="toggleGrandChild(child, index)"
                            :key="index + 1"
                        >
                            <li>
                                {{ child.tag }}

                                <icon-chevron-down v-if="child.grandchildren" />
                            </li>

                            <ul 
                                v-if="child.grandchildren"
                                class="nav-grandchild"
                            >
                                <nuxt-link
                                    v-for="(grandchild, index) in child.grandchildren"
                                    tag="li"
                                    class="nav-grandchild"
                                    :to="grandchild.url"
                                    :key="index + 1"
                                >
                                    {{ grandchild.tag }}
                                </nuxt-link>
                            </ul>
                        </nuxt-link>
                    </div>
                </li>
            </ul>
        </transition>
    </nav>
</template>




<script>    
    export default {
        name: "siteNav",
        props: {
            componentName: {
                default: "site-nav",
                type: String
            },
            nav: {
                default: null,
                type: Array
            }
        },
        data() {
            return {
                activeGrandChild: null,
            }
        },     
        methods: {            
            toggleSiteNav() {
                this.$store.commit('toggleSiteNav');
            },
            toggleGrandChild(checkGrandchild, toToggle) {
                /*  
                    default click event prevented on <nuxt-link and instead...
                    - check to see if grandchildren exist
                    - if they do just toggle the active class for the accordion (keeping the click prevented)
                    - else if no grandchildren just push to the URL 
                */
                if (checkGrandchild.grandchildren) {
                    if (toToggle === this.activeGrandChild) {
                        this.activeGrandChild = null;
                    } else {
                        this.activeGrandChild = toToggle;
                    }
                } else {
                    this.$router.push(checkGrandchild.url);
                }
            }
        }
    }
</script>