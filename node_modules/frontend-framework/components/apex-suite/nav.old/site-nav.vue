<template>  
	<nav 
        :class="componentName"
    >
        <button 
            class="no-style nav-trigger"
            :class="{ 'active' : $store.state.isVisible.siteNav }"
            role="navigation"
            aria-label="button to toggle nav"
            @click="toggleSiteNav()"
        >
            <span hidden>Toggle the side navigation</span>

            <icon-menu-close v-if="$store.state.isVisible.siteNav" />
            <icon-menu-dots v-else />
        </button>
        

        <transition name="site-nav-parent">
            <ul 
                v-if="$store.state.isVisible.siteNav"
                class="nav-parent"
            >
                <li v-for="(parent_link, index, key) in nav">
                    <span>{{ index }}</span>
                    
                    <ul class="nav-child">
                        <li 
                            v-for="(child_link, index) in parent_link"
                            :class="[{ 'expanded' : index == activeGrandChild }, { 'has-grandchild' : child_link.children }]"
                            @click="toggleGrandChild(index)"
                        >
                            <template v-if="child_link.children">
                                {{ child_link.tag }}

                                <icon-chevron-down />
                            </template>

                            <template v-else>
                                <nuxt-link
                                    :to="child_link.url"
                                    :title="child_link.tag"
                                    exact
                                >
                                    {{ child_link.tag }}
                                </nuxt-link>
                            </template>

                            <ul 
                                v-if="child_link.children"
                                class="grandchild"
                            >
                                <li v-for="grandchild_link in child_link.children">
                                    <nuxt-link
                                        :to="grandchild_link.url"
                                        :title="grandchild_link.tag"
                                        exact
                                    >
                                        {{ grandchild_link.tag }}
                                    </nuxt-link>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </transition>
    </nav>
</template>




<script>
    export default {
        name: "siteNav",
        props: {
        	componentName: {
        		default: "site-nav",
        		type: String
        	},
            nav: {
                default: null,
                type: Object
            }
        },
        data() {
            return {
                activeGrandChild: 0,
            }
        },
        mounted() {
        },
        computed: {
        },
        methods: {            
            toggleSiteNav() {
                this.$store.commit('toggleSiteNav');
            },
            toggleGrandChild(toToggle) {
                //  need to sort this out so child routes still active not null. Might need refactor
                this.activeGrandChild = toToggle;
                    
                // if (toToggle === this.activeGrandChild) {
                //     this.activeGrandChild = null;
                // } else {
                //     this.activeGrandChild = toToggle;
                // }
            }
        }
    }
</script>